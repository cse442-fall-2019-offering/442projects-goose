<!doctype html>
<html>
    <head>
        <title>Converter</title>
        <link href="style.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Overpass&display=swap" rel="stylesheet">
        <script src="JavaScript/limit_input.js"></script>
        <script src="JavaScript/unit_switcher.js" charset="utf-8"></script>
        <script src="JavaScript/input_checker.js" charset="utf-8"></script>
    </head>
    <body>
        <!-- TODO: add tiles, text inputs, dropdowns, and swap box -->
        <!-- TODO: change dropdown menu based on tile selection -->
        <!-- TODO: create visual output based on entered values -->
        <!-- TODO: create rest of website -->
        <!-- random text for tet commit -->
        <!-- more commit test -->
        <header>
          <!-- select measures here -->
          <div class="nav">
            <ul>
              <a href="temp.html">Temperature</a>
              <a class="active" href="index.html">Length</a>
              <a href="area.html">Area</a>
              <a href="vol.html">Volume</a>
              <a href="time.html">Time</a>
              <a href="speed.html">Speed</a>
              <a href="timeZones.html">Time Zones</a>
            </ul>
          </div>
        </header>
        <main>
          <!-- values are inputted here -->
          <div id="converter">
            <!-- select one unit here -->
            <div id="primary">
              <form>

                <input type="number" id="primaryInput" placeholder="Enter a value here" onkeyup="checkInput(); limit(this);" onkeydown="limit(this);">
                <select id="primarySelect">
                  <option value="inch">Inches</option>
                  <option value="feet">Feet</option>
                  <option value="yard">Yard</option>
                  <option value="mile">Mile</option>
                  <option value="kilometer">Kilometer</option>
                  <option value="centimeter">Centimeter</option>
                </select>
              </form>
            </div>
            <div id="swap">
              <button class="swapButton" onclick="switchUnits()">
                â‡Œ
              </button>
            </div>
            <!-- select the other unit here -->
            <div id="secondary">
              <form>
                <input type="number" id="secondaryInput" placeholder="Result shows up here" readonly="readonly">
                <select id="secondarySelect">
                  <option value="inch">Inches</option>
                  <option value="feet">Feet</option>
                  <option value="yard">Yard</option>
                  <option value="mile">Mile</option>
                  <option value="kilometer">Kilometer</option>
                  <option value="centimeter">Centimeter</option>
                </select>
              </form>
            </div>
          </div>
          <div class="center">
            <button id="convertButton" disabled="disabled" onclick="convertUnits(); generateVisual();">
              Convert
            </button>
          </div>
          <!-- visual output is displayed here -->
          <div class="center" id="visualizer">
            <canvas id="visual">
          </div>
          <script>
          function switchUnits(){
            var holdSelect = document.getElementById("primarySelect").options[document.getElementById("primarySelect").selectedIndex].value;
            var holdInput = document.getElementById("primaryInput").value;
            document.getElementById("primarySelect").value = document.getElementById("secondarySelect").options[document.getElementById("secondarySelect").selectedIndex].value;
            document.getElementById("primaryInput").value = document.getElementById("secondaryInput").value;
            document.getElementById("secondarySelect").value = holdSelect;
            document.getElementById("secondaryInput").value = holdInput;
          }
          function checkInput(){
            var input = document.getElementById('primaryInput').value;
            if (input != '') {
                document.getElementById('convertButton').disabled = false;
            }
            else {
                document.getElementById('convertButton').disabled = true;
            }
          }
          /*
          unimplimented unit conversion function for distance using general units
          first parameter is the input in the primary div class, the second parameter
          unit1 is the first unit to be converted to meters for ease of conversion
          and reduce hard coding. than it will take the input already converted to meters
          and convert it to the unit in unit2
          */
          function calculateConversion(input, primaryUnit, secondaryUnit){
            var seconds; //this is the base unit
            switch(primaryUnit){
              case "millimeter":
                meter = input*.001;
                break;
              case "centimeter":
                meter = input*0.01;
                break;
              case "meter":
                meter = input;
                break;
              case "kilometer":
                meter = input*1000;
                break;
              case "inch":
                meter = input *0.0254;
                break;
              case "feet":
                meter = input *0.3048;
                break;
              case "yard":
                meter = input *0.9144;
                break;
              case "mile":
                meter = input *1609.34;
                break;
            }
            switch(secondaryUnit){
              case "millimeter":
                return meter*1000;
              case "centimeter":
                return meter *100;
              case "meter":
                return meter;
              case "kilometer":
                return meter *0.001;
              case "inch":
                return meter*39.370078740157;
              case "feet":
                return meter*3.2808398950131;
              case "yard":
                return meter*1.0936132983377;
              case "mile":
                return meter *0.00062137119223733;
            }
            return meter;
          }
          function convertUnits(){
            var input = document.getElementById("primaryInput").value;
            var primaryUnit = document.getElementById("primarySelect").value;
            var secondaryUnit = document.getElementById("secondarySelect").value;
            document.getElementById("secondaryInput").value = calculateConversion(input, primaryUnit, secondaryUnit);
          }
          function generateVisual(){
            /* creating the canvas */
            var canvas = document.getElementById("visual");
            var visualizer = document.getElementById("visualizer");
            canvas.width = visualizer.offsetWidth-50;
            canvas.height = visualizer.offsetHeight-50;
            var ctx = canvas.getContext("2d");
            ctx.fillStyle = "#FFFFFF";
            ctx.fillRect(0, 0, canvas.width, canvas.width);
            /* drawing the axes */
            ctx.beginPath();
            ctx.moveTo(0, canvas.height/2 - 3);
            ctx.lineTo(canvas.width, canvas.height/2 - 3);
            ctx.strokeStyle = String(getComputedStyle(document.documentElement).getPropertyValue('--primary-color'));
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, canvas.height/2 + 3);
            ctx.lineTo(canvas.width, canvas.height/2 + 3);
            ctx.strokeStyle = String(getComputedStyle(document.documentElement).getPropertyValue('--secondary-color'));
            ctx.stroke();
            /* drawing the markings in the primary axis */
            var lowerBoundPrimary = parseFloat(document.getElementById("primaryInput").value) - 30;
            var upperBoundPrimary = parseFloat(document.getElementById("primaryInput").value) + 30;
            var scaleFactor = canvas.width/(upperBoundPrimary - lowerBoundPrimary);
            for (var i = Math.ceil(lowerBoundPrimary); i <= upperBoundPrimary; i++){
              if (i != document.getElementById("primaryInput").value && i >= 0){
                ctx.beginPath();
                ctx.moveTo(scaleFactor*(i-lowerBoundPrimary), canvas.height/2.6);
                ctx.lineTo(scaleFactor*(i-lowerBoundPrimary), canvas.height/2 - 3);
                ctx.strokeStyle = String(getComputedStyle(document.documentElement).getPropertyValue('--primary-color'));
                ctx.stroke();
                ctx.font = "10px Overpass";
                ctx.fillStyle = "#000000";
                ctx.save();
                ctx.textAlign = "left";
                ctx.textBaseline = "middle";
                ctx.translate(scaleFactor*(i-lowerBoundPrimary), canvas.height/2.8);
                ctx.rotate(-60 * Math.PI / 180);
                ctx.fillText(i, 0, 0);
                ctx.restore();
              }
            }
            /* drawing the markings in the secondary axis */
            var lowerBoundSecondary = calculateConversion(lowerBoundPrimary, document.getElementById("primarySelect").value, document.getElementById("secondarySelect").value);
            var upperBoundSecondary = calculateConversion(upperBoundPrimary, document.getElementById("primarySelect").value, document.getElementById("secondarySelect").value);
            var scaleFactor = canvas.width/(upperBoundSecondary - lowerBoundSecondary);
            var increment = 1;
            while ((upperBoundSecondary - lowerBoundSecondary)/increment < 2){
              increment /= 10;
            }
            while ((upperBoundSecondary - lowerBoundSecondary)/increment > 60){
              increment *= 10;
            }
            for (var i = Math.ceil(lowerBoundSecondary/increment)*increment; i <= upperBoundSecondary; i += increment){
              if (i != document.getElementById("secondaryInput").value && i >= 0){
                ctx.beginPath();
                ctx.moveTo(scaleFactor*(i-lowerBoundSecondary), canvas.height/2 + 3);
                ctx.lineTo(scaleFactor*(i-lowerBoundSecondary), canvas.height - canvas.height/2.6);
                ctx.strokeStyle = String(getComputedStyle(document.documentElement).getPropertyValue('--secondary-color'));
                ctx.stroke();
                ctx.font = "10px Overpass";
                ctx.save();
                ctx.textAlign = "right";
                ctx.textBaseline = "middle";
                ctx.translate(scaleFactor*(i-lowerBoundSecondary), canvas.height - canvas.height/2.8);
                ctx.rotate(-60 * Math.PI / 180);
                if (increment < 1){
                  ctx.fillText(i.toFixed(Math.abs(Math.floor(Math.log10(increment)))), 0, 0);
                }
                else{
                  ctx.fillText(i, 0, 0);
                }
                ctx.restore();
              }
            }
            /*labelling axes*/
            ctx.font = "20px Overpass";
            ctx.fillStyle = "#000000";
            ctx.textAlign = "left";
            ctx.textBaseline = "middle";
            ctx.fillText(document.getElementById("primarySelect").value, 10, 30);
            ctx.fillText(document.getElementById("secondarySelect").value, 10, canvas.height-30);
            /* labelling the converted unit */
            ctx.beginPath();
            ctx.moveTo(canvas.width/2, canvas.height/2.7);
            ctx.lineTo(canvas.width/2, canvas.height-(canvas.height/2.7));
            ctx.strokeStyle = "#000000";
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(document.getElementById("primaryInput").value, canvas.width/2, 30);
            ctx.fillText(document.getElementById("secondaryInput").value, canvas.width/2, canvas.height-30);
          }

          //Swaps units
          function switchUnits(){
            var holdSelect = document.getElementById("primarySelect").options[document.getElementById("primarySelect").selectedIndex].value;
            var holdInput = document.getElementById("primaryInput").value;
            document.getElementById("primarySelect").value = document.getElementById("secondarySelect").options[document.getElementById("secondarySelect").selectedIndex].value;
            document.getElementById("primaryInput").value = document.getElementById("secondaryInput").value;
            document.getElementById("secondarySelect").value = holdSelect;
            document.getElementById("secondaryInput").value = holdInput;
          }
          </script>
        </main>
    </body>
</html>
